水平思考クイズBOT

目標
embedding機能の活用
プロンプトの改善


問題分の作成
・タイトル
・問題
・回答
・ヒント
がサイトから入手可能なので、以下のように増やす。

・タイトル
・問題
・回答1,2,3
　-few shot promptingにするため。合ってるかは分からんけど。
・ヒント
・状況1〜複数
　-質問に対して回答をより正確にするため。前回では同様の質問をしても反対の答えになる事があったため、答え全体ではなく、各状況に合わせて回答させることで正答率を上げれるはず。

増えた回答と状況のそれぞれのembeddingを追加したものをjson形式で保存する。(問題1つにつき、1ファイルにする？)可能であればllmで回答や状況を生成しておきたい。
※問題文のjson案参照



質問された時の処理
質問をリストにして保存する
　-あとでヒントを出す際に使用する
　-ヒント、今までの質問で出ていないヒントを一つ選びヒントを出してください。とか？

embedding処理
1.質問文をエンベディングする。
2.状況それぞれについてコサイン類似度を比較する。
#0.19未満(閾値は要調整)
3.「関係性がない」を返す。
#0.3未満(閾値は要調整)
3.「関係性が低い」を返す。
#0.65以上(閾値は要調整)
3.「関係性が高い」を返す。
4.類似度が最も高かった状況を返す。

AIのAPI処理
#関係性がない
1.答えられません。を返答する。
#関係性が低い
1.質問文と類似度の高い状況、評価をプロントで渡す。
※質問返答用プロントを参照
2.[はい.いいえ]が帰ってくるので、それを返す。
3.核心には迫っていません。と返す。
#関係性が高い
1.質問文と類似度の高い状況、評価をプロントで渡す。
※質問返答用プロントを参照
2.[はい.いいえ]が帰ってくるので、それを返す。
3.核心に近づいていますねと返す。


答え合わせの時の処理
1.答え合わせようプロンプトを実施する。
2.回答は[完全一致/部分一致/不一致]のいずれかとなる。
3.入力文をembeddingする。
4.入力文と回答1〜3のコサイン類似度を比較する。

※類似度はあくまで傾向なため、一致率ではなく答えの方向性があっているよ、間違っているよのような評価が正しいか。
#完全一致
5.類似度が最も高かった回答表示し、%を表示する。また、正解と伝える。
#部分一致
5.最も高かった回答との類似度を%で表示し、方向性はいいですねと伝える。
#不一致
5.最も高かった回答との類似度を%で表示し、考え方を変えてみましょうと伝える。


問題の保存形式
タイトル
あこがれの人

問題
カオルは大好きな人に話しかけられたが、返事をしなかった。いったいなぜ？

答え1
カオルはアイドルの握手会のいわゆる「剥がし」をしており、アイドルと話すことを禁止されていたから。
答え2
大好きなアイドルから話しかけられていたが、アイドルの握手会のスタッフとして会場にいたため返事ができなかった。
答え3
カオルは大好きなアイドルから話しかけられて心の中で嬉しかったが、握手会の運営スタッフとしての立場を守るために、あえて返事をせずに仕事を続けた。

状況
・カオルはアイドルの握手会の運営スタッフ、いわゆる「剥がし」として働いている。
・ファンなのがバレるとそのアイドルのイベントにはスタッフとして参加できない
・すべてのスタッフに対してアイドルと会話しないように言われている。
・カオルはファンであることを黙ってバイトを続けたい。
・上司にバレないようにアイドルとの会話をなんとか我慢していた。
・カオルは話しかけられて嬉しかったです。
・本当は返事がしたかったです。
・相手はアイドルです。
・カオルは仕事中です。
・アイドルのあるイベントのバイトをしています。
・登場人物はカオルと大好きな人の2名



問題文json案

{
  "タイトル": {
    "text": "あこがれの人",
    "embedding": []
  },
  "問題": {
    "text": "カオルは大好きな人に話しかけられたが、返事をしなかった。いったいなぜ？",
    "embedding": []
  },
  "答え": [
    {
      "text": "カオルはアイドルの握手会のいわゆる「剥がし」をしており、アイドルと話すことを禁止されていたから。",
      "embedding": [0.089, -0.034, 0.012, 0.067, -0.045]
    },
    {
      "text": "大好きなアイドルから話しかけられていたが、アイドルの握手会のスタッフとして会場にいたため返事ができなかった。",
      "embedding": [-0.056, 0.078, 0.023, -0.012, 0.034]
    },
    {
      "text": "カオルは大好きなアイドルから話しかけられて心の中で嬉しかったが、握手会の運営スタッフとしての立場を守るために、あえて返事をせずに仕事を続けた。",
      "embedding": [0.045, -0.067, 0.089, 0.015, -0.023]
    }
  ],
  "状況": [
    {
      "text": "カオルはアイドルの握手会の運営スタッフ、いわゆる「剥がし」として働いている。",
      "embedding": [0.034, 0.012, -0.045, 0.078, -0.089]
    },
    {
      "text": "ファンなのがバレるとそのアイドルのイベントにはスタッフとして参加できない",
      "embedding": [-0.023, 0.056, 0.034, -0.078, 0.012]
    },
    {
      "text": "すべてのスタッフに対してアイドルと会話しないように言われている。",
      "embedding": [0.067, -0.034, 0.089, 0.015, -0.056]
    },
    {
      "text": "カオルはファンであることを黙ってバイトを続けたい。",
      "embedding": [-0.045, 0.078, -0.012, 0.034, 0.067]
    },
    {
      "text": "上司にバレないようにアイドルとの会話をなんとか我慢していた。",
      "embedding": [0.023, -0.089, 0.045, -0.015, 0.078]
    },
    {
      "text": "すカオルは話しかけられて嬉しかったで。",
      "embedding": [0.056, 0.012, -0.067, 0.089, -0.034]
    },
    {
      "text": "本当は返事がしたかったです。",
      "embedding": [-0.078, 0.034, 0.023, -0.056, 0.012]
    },
    {
      "text": "相手はアイドルです。",
      "embedding": [0.015, -0.045, 0.078, 0.034, -0.089]
    },
    {
      "text": "カオルは仕事中です。",
      "embedding": [0.067, 0.023, -0.034, 0.012, 0.056]
    },
    {
      "text": "アイドルのあるイベントのバイトをしています。",
      "embedding": [-0.012, 0.089, 0.045, -0.078, 0.034]
    },
    {
      "text": "登場人物はカオルと大好きな人の2名",
      "embedding": [0.056, -0.023, 0.067, 0.015, -0.045]
    }
  ]
}






答え合わせ用プロンプト
以下の手順に従って、「入力」が指定された要素を全て網羅しているかどうかを判定してください。

1.答えの確認：
  - 答えが水平思考クイズの解答として成立しているか確認する
  - 入力された状況を説明できる論理的な答えになっているか確認する

2.要素の確認:
答えから「何が起きたか」「なぜそうなったか」というストーリーの大枠を理解する上で必要な要素を抽出する

3.入力を分析：
  入力文に各要素が明示的または暗示的に含まれているか確認する

4.欠落の確認：
  要素リストの項目で、入力文から読み取れないものを列挙する

5.判定基準：
・完全一致：
- 状況の大枠が理解できている
- 答えの核となる要点（なぜそうなったのか）が表現されている
（表現方法や細かい説明の有無は問わない）
・部分一致：
- 状況の一部は理解している
- しかし重要な説明が不足している
（何が起きたかは分かるが、なぜそうなったのかが不明確な場合）
・不一致：
- 状況の理解が大きく異なる
- または全く別の解釈をしている

出力形式：
1. [完全一致/部分一致/不一致]
###2. 判定理由（各要素の有無を簡潔に説明）
###本番は実施ないように

問題:
カオルは大好きな人に話しかけられたが、返事をしなかった。いったいなぜ？
#問題分から入力

解答例:
1.カオルはアイドルの握手会のいわゆる「剥がし」をしており、アイドルと話すことを禁止されていたから。
2.大好きなアイドルから話しかけられていたが、アイドルの握手会のスタッフとして会場にいたため返事ができなかった。
3.カオルは大好きなアイドルから話しかけられて心の中で嬉しかったが、握手会の運営スタッフとしての立場を守るために、あえて返事をせずに仕事を続けた。
#問題文から入力する

入力:
カオルは大好きなアイドルから話しかけられたが、スタッフであり会話ができなかったため、返事をしなかった。
#ユーザーの入力






質問返答用プロント

#命令
以下の質問と状況の内容を比較し、質問が状況の内容と一致するかを判断してください。
判断基準：
- はい = 質問の内容が状況と一致している
- いいえ = 質問の内容が状況と反対または異なっている

#状況
[situation]

#質問
[input_text]

#判断基準の補足
1. 質問が否定形の場合：
   - 状況が肯定的 → 質問の答えは「いいえ」
   - 状況が否定的 → 質問の答えは「はい」

2. 質問が肯定形の場合：
   - 状況が肯定的 → 質問の答えは「はい」
   - 状況が否定的 → 質問の答えは「いいえ」

#回答形式
回答：[はい/いいえ]












